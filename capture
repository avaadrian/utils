# CONFIG
$serverIp = "172.16.0.99"
$interface = 1  # AflÄƒ cu `dumpcap -D` ce interfaÈ›Äƒ e activÄƒ
$outDir = "$PSScriptRoot\pcaps"
# CreeazÄƒ folderul pentru capturi dacÄƒ nu existÄƒ
New-Item -Path $outDir -ItemType Directory -Force | Out-Null
# FuncÈ›ia care face captura È™i descÄƒrcarea
function Capture-And-Download {
   param (
       [string]$filename,
       [string]$label
   )
   $pcapFile = "$outDir\$label`_$filename.pcapng"
   $url = "http://$serverIp/$label/$filename"
   $tmpFile = "$env:TEMP\$filename"
   Write-Host "ğŸ“¥ [$label] Downloading $filename and capturing to $pcapFile"
   # Start captura cu dumpcap
   $dumpcap = Start-Process -FilePath "dumpcap.exe" `
       -ArgumentList "-i $interface -w `"$pcapFile`"" `
       -WindowStyle Hidden -PassThru
   Start-Sleep -Seconds 1  # aÈ™teaptÄƒ sÄƒ porneascÄƒ dumpcap
   # DescarcÄƒ fiÈ™ierul
   Invoke-WebRequest -Uri $url -OutFile $tmpFile -UseBasicParsing
   Start-Sleep -Seconds 2  # aÈ™teaptÄƒ sÄƒ termine descÄƒrcarea
   Stop-Process -Id $dumpcap.Id  # opreÈ™te captura
   Write-Host "âœ… Saved PCAP: $pcapFile`n"
}
# CiteÈ™te listele de fiÈ™iere
$benignList = Get-Content "$PSScriptRoot\benign.txt"
$maliciousList = Get-Content "$PSScriptRoot\malicious.txt"
# Parcurge fiÈ™ierele benigne
foreach ($f in $benignList) {
   Capture-And-Download -filename $f -label "benign"
}
# Parcurge fiÈ™ierele maligne
foreach ($f in $maliciousList) {
   Capture-And-Download -filename $f -label "malicious"
}